!function(e){var a="mapboxAutocomplete",t={accessToken:"",endpoint:"https://api.mapbox.com/geocoding/v5/",mode:"mapbox.places",language:"fr",width:"100%",zindex:"1000"};function n(n,i){return this.element=e(n),this.$elem=e(this.element),this._name=a,this.settings=e.extend({},t,i),this._defaults=t,this.init()}n.prototype={options:function(e,a){this.settings[e]=a},init:function(){var a=this.element;a.wrap('<div class="address-autocomplete-wrapper"></div>');var t=e(".address-autocomplete-wrapper");a.after('<input hidden name="mbaa-found-address" value="" />'),a.after('<ul id="mbaa-result-address-autocomplete" class="mbaa-results-list"></ul>');var n,i=e("#mbaa-result-address-autocomplete"),s="",d=null,o=function(t){t.on("click",function(){var t=e(this).data("id");e.each(d,function(n,s){if(s.id===t){var d=r(s);e('input[name="mbaa-found-address"]').val(JSON.stringify(d)),i.removeClass("mbaa-fill"),a.val(d.formatted_address).removeClass("mbaa-address-autocomplete").trigger("mapboxAutocomplete.found.address",[d,s])}})})},r=function(a){var t=a.place_name.split(", ")[0],n=a.address;t=t.replace(n+" ","");var i={point:{lat:a.center[1],long:a.center[0]},formatted_address:a.place_name,region:"",country:"",city:"",zipcode:"",street:t,number:n};return e.each(a.context,function(e,a){a.id.indexOf("place")>=0?i.city=a.text:a.id.indexOf("postcode")>=0?i.zipcode=a.text:a.id.indexOf("region")>=0?i.region=a.text:a.id.indexOf("country")>=0&&(i.country_long=a.text,i.country=a.short_code)}),i};a.unbind("keydown").on("keydown",function(e){if(40===e.keyCode)return""===s?s=0:s+1<i.find("li").length&&s++,i.find("li").removeClass("selected"),i.find("li:eq("+s+")").addClass("selected"),!1;38===e.keyCode&&(""===s?s=0:s>0&&s--,i.find("li").removeClass("selected"),i.find("li:eq("+s+")").addClass("selected"))}),a.on("keydown",function(t){if(13===t.keyCode){t.preventDefault();var n=i.find("li.mbaa.selected").data("id");e.each(d,function(t,s){if(s.id===n){var d=r(s);e('input[name="mbaa-found-address"]').val(JSON.stringify(d)),i.removeClass("mbaa-fill"),a.val(d.formatted_address).removeClass("mbaa-address-autocomplete").trigger("mapboxAutocomplete.found.address",[d,s])}})}}),n=this.settings,t.css("width",n.width),a.css("width",n.width),i.css("width",n.width),t.find("ul.mbaa-results-list").css("z-index",n.zindex),a.on("keyup",function(t){if(40!==t.keyCode&&38!==t.keyCode&&13!==t.keyCode){s="";var r,l,c=e(this).val(),u=(r=c,l=n,r=encodeURI(r),l.endpoint+l.mode+"/"+r+".json?access_token="+l.accessToken+"&language="+l.language);e.get(u,function(t){a.addClass("mbaa-address-autocomplete"),i.find("li.mbaa").remove(),i.addClass("mbaa-fill"),t.features&&(d=t.features,e.each(d,function(e,a){i.append('<li data-id="'+a.id+'" class="mbaa">'+a.place_name+"</li>")}),i.find("li").each(function(a,t){var n=e(this);o(n)}))})}})}},e.fn[a]=function(t){var i=e.makeArray(arguments).slice(1);return this.each(function(){var s=e.data(this,a);if(!s){var d=new n(this,t);return e.data(this,a,d),d}s[t]?s[t].apply(s,i):e.error("Method "+t+" does not exist on Plugin ?")})}}(jQuery);